{"ast":null,"code":"import { createContext, useState, useMemo, createElement, useContext, useCallback } from 'react';\nconst STORE_DEFAULT_NAME = '__STATE_MACHINE__';\nconst STORE_ACTION_NAME = '__STATE_MACHINE_ACTION_NAME__';\nconst STATE_MACHINE_DEBUG_NAME = '___STATE_MACHINE_DEBUG__';\n\nvar getBrowserStoreData = (storageType, storeName) => {\n  const sessionStorageData = storageType.getItem(storeName);\n\n  try {\n    return sessionStorageData ? JSON.parse(sessionStorageData) : undefined;\n  } catch (_a) {\n    return undefined;\n  }\n};\n\nfunction storeFactory(storageType, name) {\n  const storeName = name || STORE_DEFAULT_NAME;\n  let store = getBrowserStoreData(storageType, storeName);\n\n  const getName = () => storeName;\n\n  const set = value => {\n    store = value;\n  };\n\n  const get = () => store;\n\n  return {\n    set,\n    get,\n    getName\n  };\n}\n\nvar isUndefined = val => val === undefined;\n\nfunction setUpDevTools(isDevMode, storageType, getName, getStore) {\n  if (typeof window === 'undefined' || !isDevMode) return; // @ts-ignore\n\n  window.STATE_MACHINE_DEBUG = value => storageType.setItem(STATE_MACHINE_DEBUG_NAME, value); // @ts-ignore\n\n\n  window.STATE_MACHINE_RESET = () => storageType.clear(); // @ts-ignore\n\n\n  window.STATE_MACHINE_GET_STORE = () => storageType.getItem(getName()); // @ts-ignore\n\n\n  window.STATE_MACHINE_SAVE_TO = name => window.localStorage.setItem(name, JSON.stringify(getStore())); // @ts-ignore\n\n\n  window.STATE_MACHINE_LOAD = ({\n    storeName,\n    data\n  }) => storageType.setItem(getName() || STATE_MACHINE_DEBUG_NAME, data || window.localStorage.getItem(storeName) || '');\n}\n\nvar StateMachineContext = createContext({\n  store: {},\n  updateStore: payload => payload\n});\n\nvar transformStore = ({\n  transform,\n  externalStoreName,\n  storageType,\n  store\n}) => transform({\n  externalStoreData: getBrowserStoreData(storageType, externalStoreName),\n  currentStoreData: store\n});\n\nfunction getSyncStoreData(defaultStoreData, options, storageType) {\n  let store = defaultStoreData;\n  const syncStoreOption = options.syncStores;\n  if (!syncStoreOption) return store;\n\n  try {\n    if (Array.isArray(syncStoreOption)) {\n      syncStoreOption.forEach(option => {\n        store = transformStore({\n          transform: option.transform,\n          externalStoreName: option.externalStoreName,\n          storageType,\n          store\n        });\n      });\n    } else if (syncStoreOption.externalStoreName && typeof syncStoreOption.transform === 'function' && typeof syncStoreOption.externalStoreName === 'string') {\n      return transformStore({\n        transform: syncStoreOption.transform,\n        externalStoreName: syncStoreOption.externalStoreName,\n        storageType,\n        store\n      });\n    } else {\n      Object.entries(syncStoreOption).forEach(([key, values]) => {\n        const browserStore = getBrowserStoreData(storageType, key);\n        values.forEach(value => {\n          store = Object.assign(Object.assign({}, store), {\n            [value]: Object.assign(Object.assign({}, store[value]), browserStore[value])\n          });\n        });\n      });\n    }\n  } catch (_a) {\n    return store;\n  }\n\n  return store;\n}\n\nconst isClient = typeof window !== 'undefined';\nconst isDevMode = process.env.NODE_ENV !== 'production';\nlet storageType = isClient ? window.sessionStorage : {\n  getItem: payload => payload,\n  setItem: payload => payload,\n  clear: () => {},\n  length: 0,\n  key: payload => payload.toString(),\n  removeItem: () => {}\n};\nlet getStore;\nlet setStore;\nlet getName;\nlet middleWaresArray = [];\n\nconst middleWare = (data = '') => {\n  if (data) {\n    // @ts-ignore\n    window[STORE_ACTION_NAME] = data;\n  }\n\n  return data;\n};\n\nfunction setStorageType(type) {\n  storageType = type;\n}\n\nfunction createStore(defaultStoreData, options = {\n  name: STORE_DEFAULT_NAME,\n  middleWares: [],\n  syncStores: undefined\n}) {\n  const storeName = options ? options.name : STORE_DEFAULT_NAME;\n  const methods = storeFactory(storageType, storeName);\n\n  if (isDevMode && isClient) {\n    // @ts-ignore\n    window['STATE_MACHINE_NAME'] = storeName;\n  }\n\n  getName = methods.getName;\n  getStore = methods.get;\n  setStore = methods.set;\n  middleWaresArray = options.middleWares;\n  setUpDevTools(isDevMode, storageType, getName, getStore);\n  setStore(getSyncStoreData(getStore() || defaultStoreData, options, storageType));\n}\n\nfunction StateMachineProvider(props) {\n  const [globalState, updateStore] = useState(getStore());\n  const value = useMemo(() => ({\n    store: globalState,\n    updateStore\n  }), [globalState]); // @ts-ignore\n\n  return createElement(StateMachineContext.Provider, Object.assign({\n    value: value\n  }, props));\n}\n\nconst actionTemplate = ({\n  options,\n  callback,\n  updateStore\n}) => payload => {\n  let result;\n  const debugName = callback ? callback.name : '';\n\n  if (isDevMode) {\n    middleWare(debugName);\n  }\n\n  if (callback) {\n    result = callback(getStore(), payload);\n  }\n\n  setStore(isUndefined(result) ? getStore() : result);\n  storageType.setItem(getName(), JSON.stringify(getStore()));\n\n  if (isUndefined(options) || options && options.shouldReRenderApp !== false) {\n    let pipeData = getStore();\n\n    if (Array.isArray(middleWaresArray) && middleWaresArray.length) {\n      pipeData = middleWaresArray.reduce((currentValue, currentFunction) => currentFunction(currentValue) || currentValue, pipeData);\n    }\n\n    updateStore(pipeData);\n  }\n};\n\nfunction useStateMachine(updateStoreFunction, options) {\n  const {\n    store: globalState,\n    updateStore\n  } = useContext(StateMachineContext);\n\n  if (updateStoreFunction && Object.keys(updateStoreFunction).length) {\n    return {\n      actions: Object.entries(updateStoreFunction).reduce((previous, [key, callback]) => Object.assign(Object.assign({}, previous), {\n        [key]: useCallback(actionTemplate({\n          options,\n          callback,\n          updateStore\n        }), [])\n      }), {}),\n      action: p => p,\n      state: globalState\n    };\n  }\n\n  return {\n    actions: {},\n    action: useCallback(updateStoreFunction ? actionTemplate({\n      options,\n      callback: updateStoreFunction,\n      updateStore\n    }) : () => {}, []),\n    state: globalState\n  };\n}\n\nexport { StateMachineContext, StateMachineProvider, createStore, setStorageType, useStateMachine };","map":{"version":3,"sources":["/home/xim/Documents/Master/twitter-app/front-end/node_modules/little-state-machine/dist/little-state-machine.es.js"],"names":["createContext","useState","useMemo","createElement","useContext","useCallback","STORE_DEFAULT_NAME","STORE_ACTION_NAME","STATE_MACHINE_DEBUG_NAME","getBrowserStoreData","storageType","storeName","sessionStorageData","getItem","JSON","parse","undefined","_a","storeFactory","name","store","getName","set","value","get","isUndefined","val","setUpDevTools","isDevMode","getStore","window","STATE_MACHINE_DEBUG","setItem","STATE_MACHINE_RESET","clear","STATE_MACHINE_GET_STORE","STATE_MACHINE_SAVE_TO","localStorage","stringify","STATE_MACHINE_LOAD","data","StateMachineContext","updateStore","payload","transformStore","transform","externalStoreName","externalStoreData","currentStoreData","getSyncStoreData","defaultStoreData","options","syncStoreOption","syncStores","Array","isArray","forEach","option","Object","entries","key","values","browserStore","assign","isClient","process","env","NODE_ENV","sessionStorage","length","toString","removeItem","setStore","middleWaresArray","middleWare","setStorageType","type","createStore","middleWares","methods","StateMachineProvider","props","globalState","Provider","actionTemplate","callback","result","debugName","shouldReRenderApp","pipeData","reduce","currentValue","currentFunction","useStateMachine","updateStoreFunction","keys","actions","previous","action","p","state"],"mappings":"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","sourcesContent":["import { createContext, useState, useMemo, createElement, useContext, useCallback } from 'react';\n\nconst STORE_DEFAULT_NAME = '__STATE_MACHINE__';\r\nconst STORE_ACTION_NAME = '__STATE_MACHINE_ACTION_NAME__';\r\nconst STATE_MACHINE_DEBUG_NAME = '___STATE_MACHINE_DEBUG__';\n\nvar getBrowserStoreData = (storageType, storeName) => {\r\n    const sessionStorageData = storageType.getItem(storeName);\r\n    try {\r\n        return sessionStorageData ? JSON.parse(sessionStorageData) : undefined;\r\n    }\r\n    catch (_a) {\r\n        return undefined;\r\n    }\r\n};\n\nfunction storeFactory(storageType, name) {\r\n    const storeName = name || STORE_DEFAULT_NAME;\r\n    let store = getBrowserStoreData(storageType, storeName);\r\n    const getName = () => storeName;\r\n    const set = (value) => {\r\n        store = value;\r\n    };\r\n    const get = () => store;\r\n    return {\r\n        set,\r\n        get,\r\n        getName,\r\n    };\r\n}\n\nvar isUndefined = (val) => val === undefined;\n\nfunction setUpDevTools(isDevMode, storageType, getName, getStore) {\r\n    if (typeof window === 'undefined' || !isDevMode)\r\n        return;\r\n    // @ts-ignore\r\n    window.STATE_MACHINE_DEBUG = (value) => storageType.setItem(STATE_MACHINE_DEBUG_NAME, value);\r\n    // @ts-ignore\r\n    window.STATE_MACHINE_RESET = () => storageType.clear();\r\n    // @ts-ignore\r\n    window.STATE_MACHINE_GET_STORE = () => storageType.getItem(getName());\r\n    // @ts-ignore\r\n    window.STATE_MACHINE_SAVE_TO = name => window.localStorage.setItem(name, JSON.stringify(getStore()));\r\n    // @ts-ignore\r\n    window.STATE_MACHINE_LOAD = ({ storeName, data, }) => storageType.setItem(getName() || STATE_MACHINE_DEBUG_NAME, data || window.localStorage.getItem(storeName) || '');\r\n}\n\nvar StateMachineContext = createContext({\r\n    store: {},\r\n    updateStore: (payload) => payload,\r\n});\n\nvar transformStore = ({ transform, externalStoreName, storageType, store, }) => transform({\r\n    externalStoreData: getBrowserStoreData(storageType, externalStoreName),\r\n    currentStoreData: store,\r\n});\n\nfunction getSyncStoreData(defaultStoreData, options, storageType) {\r\n    let store = defaultStoreData;\r\n    const syncStoreOption = options.syncStores;\r\n    if (!syncStoreOption)\r\n        return store;\r\n    try {\r\n        if (Array.isArray(syncStoreOption)) {\r\n            syncStoreOption.forEach(option => {\r\n                store = transformStore({\r\n                    transform: option.transform,\r\n                    externalStoreName: option.externalStoreName,\r\n                    storageType,\r\n                    store,\r\n                });\r\n            });\r\n        }\r\n        else if (syncStoreOption.externalStoreName &&\r\n            typeof syncStoreOption.transform === 'function' &&\r\n            typeof syncStoreOption.externalStoreName === 'string') {\r\n            return transformStore({\r\n                transform: syncStoreOption.transform,\r\n                externalStoreName: syncStoreOption.externalStoreName,\r\n                storageType,\r\n                store,\r\n            });\r\n        }\r\n        else {\r\n            Object.entries(syncStoreOption).forEach(([key, values]) => {\r\n                const browserStore = getBrowserStoreData(storageType, key);\r\n                values.forEach((value) => {\r\n                    store = Object.assign(Object.assign({}, store), {\r\n                        [value]: Object.assign(Object.assign({}, store[value]), browserStore[value]),\r\n                    });\r\n                });\r\n            });\r\n        }\r\n    }\r\n    catch (_a) {\r\n        return store;\r\n    }\r\n    return store;\r\n}\n\nconst isClient = typeof window !== 'undefined';\r\nconst isDevMode = process.env.NODE_ENV !== 'production';\r\nlet storageType = isClient\r\n    ? window.sessionStorage\r\n    : {\r\n        getItem: payload => payload,\r\n        setItem: (payload) => payload,\r\n        clear: () => { },\r\n        length: 0,\r\n        key: (payload) => payload.toString(),\r\n        removeItem: () => { },\r\n    };\r\nlet getStore;\r\nlet setStore;\r\nlet getName;\r\nlet middleWaresArray = [];\r\nconst middleWare = (data = '') => {\r\n    if (data) {\r\n        // @ts-ignore\r\n        window[STORE_ACTION_NAME] = data;\r\n    }\r\n    return data;\r\n};\r\nfunction setStorageType(type) {\r\n    storageType = type;\r\n}\r\nfunction createStore(defaultStoreData, options = {\r\n    name: STORE_DEFAULT_NAME,\r\n    middleWares: [],\r\n    syncStores: undefined,\r\n}) {\r\n    const storeName = options ? options.name : STORE_DEFAULT_NAME;\r\n    const methods = storeFactory(storageType, storeName);\r\n    if (isDevMode && isClient) {\r\n        // @ts-ignore\r\n        window['STATE_MACHINE_NAME'] = storeName;\r\n    }\r\n    getName = methods.getName;\r\n    getStore = methods.get;\r\n    setStore = methods.set;\r\n    middleWaresArray = options.middleWares;\r\n    setUpDevTools(isDevMode, storageType, getName, getStore);\r\n    setStore(getSyncStoreData(getStore() || defaultStoreData, options, storageType));\r\n}\r\nfunction StateMachineProvider(props) {\r\n    const [globalState, updateStore] = useState(getStore());\r\n    const value = useMemo(() => ({\r\n        store: globalState,\r\n        updateStore,\r\n    }), [globalState]);\r\n    // @ts-ignore\r\n    return createElement(StateMachineContext.Provider, Object.assign({ value: value }, props));\r\n}\r\nconst actionTemplate = ({ options, callback, updateStore, }) => (payload) => {\r\n    let result;\r\n    const debugName = callback ? callback.name : '';\r\n    if (isDevMode) {\r\n        middleWare(debugName);\r\n    }\r\n    if (callback) {\r\n        result = callback(getStore(), payload);\r\n    }\r\n    setStore(isUndefined(result) ? getStore() : result);\r\n    storageType.setItem(getName(), JSON.stringify(getStore()));\r\n    if (isUndefined(options) ||\r\n        (options && options.shouldReRenderApp !== false)) {\r\n        let pipeData = getStore();\r\n        if (Array.isArray(middleWaresArray) && middleWaresArray.length) {\r\n            pipeData = middleWaresArray.reduce((currentValue, currentFunction) => currentFunction(currentValue) || currentValue, pipeData);\r\n        }\r\n        updateStore(pipeData);\r\n    }\r\n};\r\nfunction useStateMachine(updateStoreFunction, options) {\r\n    const { store: globalState, updateStore } = useContext(StateMachineContext);\r\n    if (updateStoreFunction && Object.keys(updateStoreFunction).length) {\r\n        return {\r\n            actions: Object.entries(updateStoreFunction).reduce((previous, [key, callback]) => (Object.assign(Object.assign({}, previous), { [key]: useCallback(actionTemplate({\r\n                    options,\r\n                    callback,\r\n                    updateStore,\r\n                }), []) })), {}),\r\n            action: p => p,\r\n            state: globalState,\r\n        };\r\n    }\r\n    return {\r\n        actions: {},\r\n        action: useCallback(updateStoreFunction\r\n            ? actionTemplate({\r\n                options,\r\n                callback: updateStoreFunction,\r\n                updateStore,\r\n            })\r\n            : () => { }, []),\r\n        state: globalState,\r\n    };\r\n}\n\nexport { StateMachineContext, StateMachineProvider, createStore, setStorageType, useStateMachine };\n"]},"metadata":{},"sourceType":"module"}